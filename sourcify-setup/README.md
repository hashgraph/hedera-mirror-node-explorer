# Local sourcify set-up (for smart contract verification)

This set-up uses an nginx reverse proxy in front of the 3 sourcify services (ui, server, repository) in order to
support HTTPS. The SSL set-up is based on a self-signed certificate for the localhost domain.
The certificate and private key are generated by the npm script `sourcify:setup` using openssl and stored under `sourcify-setup/nginx/certificate/`

The design of the sourcify repository (itself based on an nginx reverse proxy) is such that it requires to be on a distinct host,
so it cannot be accessed via localhost like the ui and server services. 
This is why the setup requires to have the following definition added to /etc/hosts:
`127.0.0.1 repository.local`

This testing setup does not require any build of sourcify and relies on the 3 sourcify docker images, 
which will be retrieved from `ghcr.io/hashgraph/hedera-sourcify` if they have not been built locally.

The npm script `sourcify:setup` will:
- check that repository.local is defined in /etc/hosts 
- generate the self-signed certificate for localhost domain if needed
- check that docker is running

## Check that the set-up is operational

```shell
# Invoke the sourcify server API to make sure the browser accepts the self-signed certificate
open https://localhost/server/chains

# Check the result of the above command contains something similar to:
[
 {"name":"Ganache Localhost","chainId":1337,"rpc":["http://localhost:8545"],"supported":true},
 {"name":"Hedera Mainnet","chainId":295,"rpc":["https://mainnet.hashio.io/api"],"supported":true},
 {"name":"Hedera Testnet","chainId":296,"rpc":["https://testnet.hashio.io/api"],"supported":true},
 {"name":"Hedera Previewnet","chainId":297,"rpc":["https://previewnet.hashio.io/api"],"supported":true},
 {"name":"Hedera Localnet","chainId":298,"rpc":["http://host.docker.internal:7546"],"supported":true},
 {"name":"Hardhat Network Localhost","chainId":31337,"rpc":["http://localhost:8545"],"supported":true}
]

# Check the sourcify UI service;
open https://localhost

# Chekc the sourcify repository service:
open https://repository.local
```
